import{r as o,q as W,j as e,Y as x,y as b,b as f}from"./app-WkCQ_0mE.js";import{A as J}from"./AuthenticatedLayout-CvNJQ03m.js";import{G as R}from"./GuestLayout-BroVYPIp.js";import{o as T,b as Y,h as L,d as G,e as S,g as O,u as P}from"./firebase-UxZUsInj.js";import U from"./Spinner-BetlNvTM.js";import"./Dropdown-BuLuLwFS.js";import"./transition-D7_gyUx8.js";function Z({auth:r,data:V}){var N;const[m,k]=o.useState(null),[p,d]=o.useState(!1);o.useState(!1);const[C,u]=o.useState(!1),{props:E}=W();let{inviteGameCode:s}=E;console.log(s),o.useEffect(()=>{async function i(){if(s)try{(await f.post(`/api/code-game/${s}`)).data.game?d(!0):d(!1)}catch(a){d(!1),console.log("Error checking if game code is valid:",a.response)}else d(!1)}i();const t=T(Y,a=>{k(a),console.log(a?"User set on auth state changed in Authenticated layout":"User not on on auth state changed in Authenticated layout",a)});return()=>t()},[]);const F=!!(r!=null&&r.user||m),[_,q]=o.useState(""),[g,y]=o.useState(""),[l,w]=o.useState(null),[j,h]=o.useState(null),n=((N=r==null?void 0:r.user)==null?void 0:N.email)||(m==null?void 0:m.email)||"",A=async i=>{if(i.preventDefault(),!n){console.error("No user email found in Game when starting new game from Welcome page.");return}u(!0);try{const t=await f.post(`/api/create-game/${n}`);q(t.data.gameId),w(null),console.log("Successfully created a new game:",t.data);const a=t.data.gameId.toString();try{await L(G(S,"gameRooms",a),{players:[n]}),b.visit(`/game/${t.data.gameId}/${t.data.gameCode}`),console.log("Game added to Firestore successfully")}catch(c){console.error("Error adding game to Firestore:",c)}}catch(t){console.log("Error creating game:",t.response.data.game_code),w(t.response.data.game_code)}finally{u(!1)}},D=async i=>{if(i.preventDefault(),!g&&!l&&!s){h("Please provide a game code."),console.log("No game code found in Game when joining game from Welcome page.");return}if(!n){console.error("No user email found in Game when joining game from Welcome page.");return}u(!0);try{const t=await f.post("/api/join-game",{gameCode:l||g||s||"",userEmail:n});console.log("Joined game successfully:",t.data),y("");const a=G(S,"gameRooms",t.data.gameId.toString());try{const c=await O(a);if(c.exists()){const v=c.data().players||[];if(v.includes(n))console.log("User already exists in the game in Firebase");else{const I=[...v,n];await P(a,{players:I}),console.log("User added to the game in Firebase successfully")}b.visit(`/game/${t.data.gameId}/${t.data.gameCode}`)}else console.error("Game document does not exist in Firebase")}catch(c){console.error("Error updating game document in Firebase:",c)}}catch(t){t.response.data.message?h(t.response.data.message):t.response.data.error&&h(t.response.data.error),console.log("Error joining game:",t.response.message.data)}finally{u(!1)}};return e.jsxs("div",{children:[e.jsx(x,{title:"Welcome"}),e.jsx("div",{className:"bg-transparent text-black/50 dark:bg-black dark:text-white/50",children:e.jsx("div",{className:"relative min-h-screen flex flex-col selection:bg-[#FF2D20] selection:text-white",children:e.jsx("div",{className:"relative mx-auto w-full max-w-2xl",children:F?e.jsxs(J,{user:r.user||m,children:[e.jsx(x,{title:"Spy Online"}),e.jsxs("div",{className:"GameLobby bg-gradient-to-r from-brightpurple to-darkpurple p-4 flex flex-col justify-center items-center",children:[e.jsx("h1",{className:"text-3xl text-brightyellow font-bold mb-4",children:"Welcome to Spy!"}),e.jsx("img",{className:"w-48 rounded-full",src:"android-chrome-512x512.png",alt:"Logo"}),e.jsx("div",{className:"FormContainer mb-8",children:!l&&e.jsx("form",{onSubmit:A,children:e.jsx("button",{className:"bg-brightpurple text-brightyellow py-2 px-4 mt-4 rounded-md hover:bg-darkpurple focus:outline-none",type:"submit",children:"Create New Game"})})}),j&&e.jsx("p",{className:"mt-4 text-red-500 text-center mt-0 mb-4 w-full bg-transparent ",children:j}),e.jsxs("div",{className:"FormContainer mb-8 flex flex-col items-center",children:[e.jsxs("form",{className:"flex flex-col justify-center items-center",onSubmit:D,children:[e.jsx("label",{className:"block mb-2 flex flex-col justify-center items-center",children:!l&&(!s||!p)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-brightyellow",children:"Game Code:"}),e.jsx("input",{className:"w-full mt-2 outline-brightyellow p-2 border border-brightyellow text-brightyellow rounded-md focus:outline-none bg-gradient-to-r from-brightpurple to-darkpurple",type:"text",value:g,onChange:i=>y(i.target.value)})]})}),e.jsxs("button",{className:"bg-brightpurple text-brightyellow py-2 px-4 rounded-md hover:bg-darkpurple focus:outline-none",type:"submit",children:["Join Game ",l||(s&&p?s:"")]})]}),s&&p&&e.jsx("button",{onClick:()=>{s="",b.visit("/")},className:"bg-brightpurple text-brightyellow py-2 px-4 mt-4 rounded-md hover:bg-darkpurple focus:outline-none",children:"Join Another Game"})]})]}),C&&e.jsx(U,{})]}):e.jsxs(R,{children:[e.jsx(x,{title:"Spy Online"}),e.jsx("h1",{className:"text-3xl text-center bg-transparent text-brightyellow font-bold mb-4",children:"Welcome to Spy Online!"}),e.jsx("img",{className:"w-48 text-center rounded-full",src:"android-chrome-512x512.png",alt:"Logo"}),e.jsx("p",{className:"mt-4 text-brightyellow w-full bg-transparent ",children:"Game background:"}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"You're an FBI detective."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"Problem: someone in your department is an enemy spy."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"Your full department has been brought in. You must question each other to discover the spy."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"What you need to play:"}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"3-12 people."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"All in same room or same call"}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"Each has their own phone, computer, or tablet."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"Game objectives:"}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"The spy: try to guess the round's location. Infer from others' questions and answers."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"Other players: figure out who the spy is."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"Round length: 6-10 minutes. Shorter for smaller groups, longer for larger."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:`The location: round starts, each player is given a location. The location is the same for all players (e.g., the bank) except for one player, who is randomly the "spy". The spy does not know the round's location.`}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:'Questioning: the game leader (person who started the game) begins by questioning another player about the location. Example: ("is this a place where children are welcome?").'}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"Answering: the questioned player must answer. No follow up questions allowed. After they answer, it's then their turn to ask someone else a question. This continues until round is over."}),e.jsx("p",{className:"text-brightyellow w-full bg-transparent ",children:"No retaliation questions: if someone asked you a question for their turn, you cannot then immediately ask them a question back for your turn. You must choose someone else."})]})})})})]})}export{Z as default};
